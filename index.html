<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ æ™‚é–“å£“åŠ›å–®å­—æ¸¬é©— (Time Attack)</title>
    <style>
        /* åŸºç¤æ¨£å¼ */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8; /* æŸ”å’Œè—è‰²èƒŒæ™¯ */
            color: #333;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #d9534f; /* é†’ç›®ç´…è‰²æ¨™é¡Œ */
        }
        
        /* çµ±è¨ˆèˆ‡ç´€éŒ„å€ */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 2px solid #eee;
        }
        .stat-item {
            font-size: 1.1em;
            font-weight: bold;
        }
        .high-score {
            color: #ffc107; /* çš‡å† é‡‘è‰² */
        }
        .combo-display {
            color: #e67e22; /* Combo æ©˜è‰² */
            font-size: 1.5em;
            transition: transform 0.2s;
        }

        /* å–®å­—é¡¯ç¤ºå€ */
        .chinese-word {
            font-size: 3em;
            margin: 20px 0;
            padding: 10px;
            display: inline-block;
            color: #2c3e50;
        }
        
        /* æ™‚é–“å£“åŠ› Bar æ¨£å¼ */
        .time-bar-container {
            width: 100%;
            height: 25px;
            background-color: #eee;
            border-radius: 12px;
            margin: 10px 0 20px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        #time-bar {
            height: 100%;
            width: 100%; /* åˆå§‹ç‚º 100% */
            background-color: #f39c12; /* åˆå§‹æ©˜è‰² */
            transition: width 0.1s linear; /* å¹³æ»‘ç¸®çŸ­ */
        }

        /* è¼¸å…¥èˆ‡æŒ‰éˆ• */
        #answer-input {
            padding: 12px;
            width: 70%;
            margin-bottom: 15px;
            border: 3px solid #ccc;
            border-radius: 8px;
            font-size: 1.2em;
            text-align: center;
        }
        button {
            padding: 12px 25px;
            background-color: #2ecc71; /* ç¶ è‰²æŒ‰éˆ• */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #27ae60;
        }

        /* è¨Šæ¯èˆ‡çµæœ */
        #message {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.3em;
            min-height: 30px; 
            opacity: 0;
            transition: opacity 0.5s;
        }
        .correct { color: #28a745; }
        .incorrect { color: #dc3545; }
        .show { opacity: 1 !important; }

        /* éŠæˆ²çµæŸè“‹æ¿ */
        #game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #game-over-overlay button {
            background-color: #e74c3c;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>â³ Time Attack âš¡ å–®å­—æŒ‘æˆ°</h1>

    <div class="stats-bar">
        <div class="stat-item high-score">
            ğŸ‘‘ æœ€é«˜ç´€éŒ„: <span id="high-score-display">0</span>
        </div>
        <div class="stat-item">
            åˆ†æ•¸: <span id="score-display">0</span>
        </div>
        <div class="stat-item combo-display" id="combo-display"></div>
    </div>
    
    <div class="time-bar-container">
        <div id="time-bar"></div>
    </div>
    
    <div class="chinese-word" id="chinese-display">é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€</div>

    <input type="text" id="answer-input" placeholder="è«‹è¼¸å…¥è‹±æ–‡å–®å­—æˆ–ç‰‡èª" disabled>
    <br>
    
    <button id="start-button" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    <button id="submit-button" onclick="checkAnswer()" disabled>ç¢ºèªç­”æ¡ˆ</button>
    
    <div id="message"></div>
</div>

<div id="game-over-overlay">
    <h2>æ™‚é–“åˆ°ï¼æŒ‘æˆ°å¤±æ•—ï¼</h2>
    <p>æ‚¨çš„åˆ†æ•¸æ˜¯: <span id="final-score">0</span></p>
    <p id="new-high-score-msg"></p>
    <button onclick="window.location.reload()">å†ç©ä¸€æ¬¡</button>
</div>

<script>
    // --- I. åƒæ•¸èˆ‡å–®å­—åº« ---

    const vocabulary = {
        "ç…§ç‰‡": "photo", "ç•¶ç„¶": "of course", "èŠ±è²»": "cost", "å…ƒ": "dollar", "ç™¼é€;å¯„": "send",
        "åŒ…è£¹": "package", "ä»˜éŒ¢": "pay", "åƒ¹éŒ¢": "price", "ä½çš„": "low", "èŠ±è²»": "spend",
        "åˆ†(è²¨å¹£å–®ä½)": "cent", "ä¾¿å®œçš„": "cheap", "æ“”å¿ƒ;æ†‚æ…®": "worry", "é›¨å‚˜": "umbrella",
        "æ–¹ä¾¿çš„": "convenient", "é çš„": "far", "å»æ‰€": "restroom", "åŸé®": "town",
        "ä¾¿åˆ©å•†ç«™": "convenience store", "å°åˆ·": "print", "å¸³å–®": "bill", "å¾…;åœç•™": "stay",
        "ç™¾è²¨å…¬å¸": "department store", "ç¥ˆæ±‚;ç¦±å‘Š": "pray", "å¯ºå»Ÿ": "temple",
        "å¤–åœ‹äºº": "foreigner", "æƒ³åˆ°": "think of", "éŠå®¢": "visitor", "å¤–åœ‹çš„": "foreign",
        "æŠµé”;è§¸åŠ": "reach", "è²´çš„": "expensive", "åŸå¸‚": "city", "èˆ’é©çš„": "comfortable",
        "ä¸å¤š;å°‘è¨±": "little", "å¤§éƒ¨ä»½çš„": "most", "æŸäºº": "someone", "å¹«å¿™": "lend a hand",
        "è±å¯Œçš„": "rich", "ä»¥ç‚ºå‚²": "be proud of...", "ç„¡å°¾ç†Š": "koala", "æ™¯è‰²": "scenery",
        "æ—…è¡Œ": "travel", "å¾€ä»»ä½•åœ°æ–¹": "anywhere", "æ­¤å¤–": "besides"
    };
    const chineseWords = Object.keys(vocabulary);

    // éŠæˆ²ç‹€æ…‹è®Šæ•¸
    let currentChineseWord = '';
    let score = 0;
    let combo = 0;
    let highScore = 0;
    let level = 1;
    let totalTime = 10; // åŸºç¤æ™‚é–“ (ç§’)
    let timeLeft = totalTime;
    let timerInterval = null;
    const MIN_TIME = 5; // æœ€å°‘çµ¦ 5 ç§’

    // DOM å…ƒç´ å¿«å–
    const elements = {
        display: document.getElementById('chinese-display'),
        input: document.getElementById('answer-input'),
        score: document.getElementById('score-display'),
        combo: document.getElementById('combo-display'),
        highScore: document.getElementById('high-score-display'),
        timeBar: document.getElementById('time-bar'),
        message: document.getElementById('message'),
        overlay: document.getElementById('game-over-overlay'),
        startButton: document.getElementById('start-button'),
        submitButton: document.getElementById('submit-button')
    };

    // --- II. éŠæˆ²æµç¨‹æ§åˆ¶ ---

    /**
     * åˆå§‹åŒ–éŠæˆ²å’Œè¼‰å…¥æœ€é«˜ç´€éŒ„
     */
    function initializeGame() {
        const savedScore = localStorage.getItem('highScore');
        highScore = savedScore ? parseInt(savedScore, 10) : 0;
        elements.highScore.textContent = highScore;
        elements.display.textContent = 'æº–å‚™å¥½äº†å—ï¼Ÿ';
    }

    /**
     * é–‹å§‹æˆ–é‡æ–°é–‹å§‹éŠæˆ²
     */
    function startGame() {
        // é‡è¨­ç‹€æ…‹
        score = 0;
        combo = 0;
        level = 1;
        updateStats();

        elements.startButton.style.display = 'none';
        elements.submitButton.disabled = false;
        elements.input.disabled = false;
        elements.input.focus();
        elements.overlay.style.display = 'none';
        
        nextWord();
    }
    
    /**
     * è™•ç†æ™‚é–“ç”¨ç›¡ï¼ŒéŠæˆ²çµæŸ
     */
    function gameOver() {
        clearInterval(timerInterval);
        elements.submitButton.disabled = true;
        elements.input.disabled = true;
        
        let msg = '';
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('highScore', highScore);
            elements.highScore.textContent = highScore;
            msg = 'âœ¨ æ–°çš„æœ€é«˜ç´€éŒ„ï¼æ­å–œï¼';
        }

        document.getElementById('final-score').textContent = score;
        document.getElementById('new-high-score-msg').textContent = msg;
        elements.overlay.style.display = 'flex'; // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
    }

    /**
     * è¼‰å…¥ä¸‹ä¸€é¡Œ
     */
    function nextWord() {
        clearInterval(timerInterval); // åœæ­¢ç•¶å‰è¨ˆæ™‚å™¨

        // é›£åº¦æ§åˆ¶ï¼šæ¯ 5 é¡Œå‡ç´šä¸€æ¬¡ï¼Œæ™‚é–“æ¸›å°‘ 0.5 ç§’ï¼Œä½†æœ€å°‘ 5 ç§’
        if (score > 0 && score % 50 === 0) { // å‡è¨­æ¯ 10 åˆ† (1é¡Œ) ç®—ä¸€é»ï¼Œ50åˆ†å‡ç´š
             level++;
             totalTime = Math.max(MIN_TIME, totalTime - 0.5);
        }

        // é‡è¨­ä»‹é¢
        elements.input.value = '';
        elements.input.disabled = false;
        elements.input.focus();
        elements.message.classList.remove('show');
        
        // å–å¾—ä¸¦é¡¯ç¤ºæ–°çš„å–®å­—
        currentChineseWord = chineseWords[Math.floor(Math.random() * chineseWords.length)];
        elements.display.textContent = currentChineseWord;
        
        // å•Ÿå‹•è¨ˆæ™‚å™¨
        timeLeft = totalTime;
        startTimer();
    }

    // --- III. è¨ˆæ™‚å™¨èˆ‡æ™‚é–“ Bar ---

    /**
     * å•Ÿå‹•è¨ˆæ™‚å™¨é‚è¼¯
     */
    function startTimer() {
        const startTime = Date.now();
        const endTime = startTime + totalTime * 1000;

        function updateBar() {
            const now = Date.now();
            const remainingTime = endTime - now;
            
            if (remainingTime <= 0) {
                gameOver();
                return;
            }

            // æ›´æ–°æ™‚é–“
            timeLeft = remainingTime / 1000;
            
            // æ›´æ–° Bar å¯¬åº¦å’Œé¡è‰²
            const percentage = (remainingTime / (totalTime * 1000)) * 100;
            elements.timeBar.style.width = `${percentage}%`;
            
            if (percentage <= 30) {
                elements.timeBar.style.backgroundColor = '#e74c3c'; // ç´…è‰²
            } else if (percentage <= 60) {
                elements.timeBar.style.backgroundColor = '#f39c12'; // æ©˜è‰²
            } else {
                elements.timeBar.style.backgroundColor = '#3498db'; // è—è‰²
            }
        }
        
        timerInterval = setInterval(updateBar, 100);
        updateBar(); // ç«‹å³åŸ·è¡Œä¸€æ¬¡ï¼Œé¿å…å»¶é²
    }


    // --- IV. è¨ˆåˆ†èˆ‡ç­”æ¡ˆæª¢æŸ¥ ---

    /**
     * æª¢æŸ¥å­¸ç”Ÿè¼¸å…¥çš„ç­”æ¡ˆ
     */
    function checkAnswer() {
        if (!currentChineseWord || elements.input.disabled) return;

        const inputAnswer = elements.input.value.trim().toLowerCase();
        // è™•ç†ç‰‡èªå¾Œé¢çš„ ...
        const correctAnswer = vocabulary[currentChineseWord].trim().toLowerCase().replace('...', '').replace('.', ''); 

        elements.input.disabled = true; // æª¢æŸ¥å¾Œå…ˆé–å®šè¼¸å…¥

        if (inputAnswer === correctAnswer) {
            // ç­”å°é‚è¼¯
            combo++;
            calculateScore();
            displayMessage('âœ… æ­£ç¢ºï¼', 'correct');

            setTimeout(nextWord, 700); // å»¶é² 0.7 ç§’å¾Œé€²å…¥ä¸‹ä¸€é¡Œ
        } else {
            // ç­”éŒ¯é‚è¼¯
            combo = 0; // Combo æ­¸é›¶
            updateStats();
            clearInterval(timerInterval); // ç­”éŒ¯åœæ­¢è¨ˆæ™‚

            elements.timeBar.style.width = '100%'; // é‡è¨­ Bar è¦–è¦º
            elements.timeBar.style.backgroundColor = '#e74c3c';
            
            displayMessage(`âŒ éŒ¯èª¤ï¼æ­£è§£æ˜¯ï¼š${vocabulary[currentChineseWord]}`, 'incorrect');

            setTimeout(gameOver, 1500); // å»¶é² 1.5 ç§’å¾ŒçµæŸéŠæˆ²
        }
    }

    /**
     * è¨ˆç®—ä¸¦æ›´æ–°åˆ†æ•¸
     */
    function calculateScore() {
        const basePoints = 10;
        
        // é€Ÿåº¦çå‹µ: å‰©é¤˜æ™‚é–“ç™¾åˆ†æ¯”æ±ºå®šçå‹µå€æ•¸ (0 ~ 1)
        const timeBonus = Math.max(0, timeLeft / totalTime); // å‰©é¤˜æ™‚é–“è¶Šå¤šï¼Œæ¥è¿‘ 1
        const speedPoints = Math.round(basePoints * timeBonus); 
        
        // Combo åŠ æˆ: é”åˆ° Combo æ‰æœƒåŠ æˆ (ä¾‹å¦‚ Combo 3 æ™‚ï¼Œå€æ•¸æ˜¯ 2)
        const comboMultiplier = combo > 1 ? combo : 1; 

        const earnedPoints = (basePoints + speedPoints) * comboMultiplier;
        score += earnedPoints;

        updateStats();
    }

    /**
     * æ›´æ–°ç•«é¢ä¸Šçš„åˆ†æ•¸å’Œ Combo é¡¯ç¤º
     */
    function updateStats() {
        elements.score.textContent = score;

        if (combo > 1) {
            elements.combo.textContent = `ğŸ”¥ Combo x${combo}`;
        } else {
            elements.combo.textContent = '';
        }
    }
    
    /**
     * é¡¯ç¤ºçµæœè¨Šæ¯
     */
    function displayMessage(text, className) {
        elements.message.textContent = text;
        elements.message.className = className + ' show'; // é¡¯ç¤ºè¨Šæ¯
    }

    // --- V. äº‹ä»¶ç›£è½ ---
    
    // ç›£è½ Enter éµï¼Œç­‰æ–¼é»æ“Šã€Œç¢ºèªç­”æ¡ˆã€
    elements.input.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') {
            checkAnswer();
        }
    });

    // ç¶²é è¼‰å…¥å¾Œåˆå§‹åŒ–
    window.onload = initializeGame;
</script>

</body>
</html>